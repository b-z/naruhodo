<!doctype html>
<html>
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1">
<title>README.md</title></head>
<body><h1>Naruhodo!</h1>
<p><zimg src="naruhodo/img/logo-black-light.png" width="150px"></zimg></p>
<p>Champion project of Mercari Hackathon 2018</p>
<p><a href="https://b-z.github.io/naruhodo" target="_blank" >https://b-z.github.io/naruhodo</a></p>
<p><zimg src="naruhodo/img-doc/hackathon.jpg" alt="></zimg></p>
<hr />
<h3>What is this?</h3>
<p><strong>Naruhodo!</strong> means &quot;I see!&quot; or &quot;Aha moment&quot; in Japanese.</p>
<p>This application is designed for students, using AR technology to help them do some wonderful scientific experiments at home.</p>
<p>Currently, it provides a simple optical experiment for demonstration. Users are free to use lenses, mirrors, etc. in it.</p>
<p><zimg src="naruhodo/img-doc/naruhodo.big.jpg" alt="29"></zimg></p>
<h3>Why do you do this?</h3>
<p>Education is the foundation of a country. <strong>Equal and quality education</strong> is very important. The imbalance of educational resources is a common problem between China and Japan. In a top school, students receive the best education and can do research in the laboratory, which is not possible for students in other schools.</p>
<p>I was born in a poor city. In my student days, I enjoyed to do interesting scientific experiments at home. For example, give me a copper wire (Cu), I will heat it on the fire to get copper oxide (CuO), then put the copper oxide into vinegar (CH<sub>3</sub>COOH), I will finally get a beautiful blue copper acetate (Cu(CH<sub>3</sub>COO)<sub>2</sub>) solution. But a serious problem is that my home cannot always provide the right experiment tools. And it is not safe to do some experiments at home.</p>
<p>AR (<a href="https://en.wikipedia.org/wiki/Augmented_reality">Augmented Reality</a>) is a new technology which can mix the real world and the virtual world. I hope to use this technology to help students who are interested in science, to do interesting experiments at home.</p>
<h3>How can I play with it?</h3>
<p>First, you should print some markers (<code>naruhodo/markers-print/print.pdf</code>):</p>
<p><zimg src="naruhodo/markers-print/print-preview.png" width="400px"></zimg></p>
<p>The last two together constitute a light source, and the other four markers are convex lens, concave lens, spherical mirror and plane mirror, respectively.</p>
<p>Place these markers on your desk and play!</p>
<h3>How does it work?</h3>
<p>Currently, the core of <strong>Naruhodo!</strong> is designed as a three-layer structure:</p>
<ul>
<li>Layer-3 is the basic layer. It captures video through the camera of the user&#39;s device. <code>AR.js</code> analyzes the position and orientation of the markers relative to the camera from the video stream.</li>
<li>Layer-2 is the logical layer. In this layer, the light source and other optical instruments are generated from the markers, and the result of the interaction of the light with the optical instruments is calculated.</li>
<li>And Layer-1 is the visualization layer. It uses <code>three.js</code> to render the calculated models on the web page.</li>

</ul>
<p>Here, Ar.js and three.js are two famous open-source libraries. They provide basic AR and model rendering capabilities, respectively. Since they only provide very basic APIs, I still have a lot of work to do. For example, to make the detection more robust in Layer-3, and to generate 3D models and light sources in Layer-1.</p>
<h3>How can I deploy?</h3>
<ul>
<li><p><strong>Naruhodo!</strong> should be visited through an <code>https</code> website, otherwise it has no permission to open the camera of your iOS device.</p>
</li>
<li><p>To set-up a simple https server, you can do this:</p>
<pre><code class="language-bash" lang="bash">npm install -g http-server
openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout key.pem -out cert.pem
http-server -S -C cert.pem -o -c-1
</code></pre>
</li>
<li><p>Then, open <a href="https://localhost:8080." target="_blank" >https://localhost:8080.</a></p>
</li>

</ul>
<h3>Advantages</h3>
<ul>
<li>No special experiment tools are required. All you need to prepare is a phone (or tablet) and some markers.</li>
<li>You can see the light path. Even in laboratory, it is hard to visualize the light path in an optical experiment.</li>
<li>You can adjust the parameters of every experiment equipment. For example, the focal length of a lens.</li>
<li>It combines the virtual and reality, so that you can feel the scale of each object in reality.</li>

</ul>
<h3>Disadvantages</h3>
<ul>
<li>Simulating the glass material of the lens as realistically as possible will make the display look better, but on a web page, computing resources are not enough to achieve such a function.</li>
<li>ARToolKit is not stable enough. Position of a marker may be ambiguous.</li>

</ul>
<h3>Your inspiration?</h3>
<p>My inspiration comes from Nintendo LABO and teamLabâ­ï¸ &#39;s exhibitions. I think an educational application should not be limited to virtual, but should be combined with the reality.</p>
<table>
<thead>
<tr><th style="text-align:center;" ><zimg src="naruhodo/img-doc/labo.jpg" alt="labo" ></zimg></th><th style="text-align:center;" ><zimg src="naruhodo/img-doc/teamlab.jpeg" alt="teamlab" ></zimg></th></tr></thead>
<tbody><tr><td style="text-align:center;" >Nintendo LABO</td><td style="text-align:center;" >teamLabâ­ï¸</td></tr></tbody>
</table>
<h3>What will you do next?</h3>
<ul>
<li>Make it work better.</li>
<li>Design a simple game about it.</li>

</ul>
<h3>Images</h3>
<p><zimg src="naruhodo/img-doc/1.png" alt="1" ></zimg></p>
<p>ğŸ”¼ Test the detection of the markers</p>
<p><zimg src="naruhodo/img-doc/2.png" alt="2" ></zimg></p>
<p>ğŸ”¼ Add a plane according to the average position &amp; rotation of the markers (deprecated now)</p>
<p><zimg src="naruhodo/img-doc/3.png" alt="3" ></zimg></p>
<p>ğŸ”¼ Add a light to the scene</p>
<p><zimg src="naruhodo/img-doc/4.png" alt="4" ></zimg></p>
<p><zimg src="naruhodo/img-doc/5.png" alt="5" ></zimg></p>
<p>ğŸ”¼ Draw a thick laser between two points</p>
<p><zimg src="naruhodo/img-doc/6.png" alt="6" ></zimg></p>
<p>ğŸ”¼ A point light ğŸ‰</p>
<p><zimg src="naruhodo/img-doc/7.png" alt="7" ></zimg></p>
<p>ğŸ”¼ Add GUI to the prototype. (Mobile &amp; Computer)</p>
<p><zimg src="naruhodo/img-doc/8.png" alt="8" ></zimg></p>
<p>ğŸ”¼ Emmmmm...An invisible concave mirror.</p>
<p><zimg src="naruhodo/img-doc/9.png" alt="9" ></zimg></p>
<p>ğŸ”¼ The concave mirror is shown both on mobile and computer</p>
<p><zimg src="naruhodo/img-doc/10.png" alt="10" ></zimg></p>
<p>ğŸ”¼ A invisible convex lens</p>
<p><zimg src="naruhodo/img-doc/11.png" alt="11" ></zimg></p>
<p>ğŸ”¼ The concave mirror is now visible ğŸ‰</p>
<p><zimg src="naruhodo/img-doc/12.jpg" alt="12" ></zimg></p>
<p>ğŸ”¼ Some notes</p>
<p><zimg src="naruhodo/img-doc/13.png" alt="13" ></zimg></p>
<p>ğŸ”¼ Draw a lemon ğŸ‹ (è¯¯</p>
<p><zimg src="naruhodo/img-doc/15.png" alt="15" ></zimg></p>
<p>ğŸ”¼ Test the refraction (deprecated now)</p>
<p><zimg src="naruhodo/img-doc/16.png" alt="16" ></zimg></p>
<p><zimg src="naruhodo/img-doc/17.png" alt="17" ></zimg></p>
<p>ğŸ”¼ Test complex cases</p>
<p><zimg src="naruhodo/img-doc/18.png" alt="18" ></zimg></p>
<p>ğŸ”¼ Add a texture to the mirror (deprecated now) and support colorful lasers</p>
<p><zimg src="naruhodo/img-doc/19.png" alt="19" ></zimg></p>
<p>ğŸ”¼ Add some textures to the elements</p>
<p><zimg src="naruhodo/img-doc/20.png" alt="20" ></zimg></p>
<p>ğŸ”¼ Use average rotation and height among the markers</p>
<p><zimg src="naruhodo/img-doc/21.png" alt="21" ></zimg></p>
<p>ğŸ”¼ Draw a base under each element</p>
<p><zimg src="naruhodo/img-doc/26.jpg" alt="26" ></zimg></p>
<p><zimg src="naruhodo/img-doc/27.jpg" alt="27" ></zimg></p>
<p><zimg src="naruhodo/img-doc/23.jpg" alt="23" ></zimg></p>
<p><zimg src="naruhodo/img-doc/24.png" alt="24" ></zimg></p>
<p>ğŸ”¼ Turn markers into bricks</p>
<p><zimg src="naruhodo/img-doc/26.png" alt="26" ></zimg></p>
<p>ğŸ”¼ Draw shadowsğŸ‰</p>
<p><zimg src="naruhodo/img-doc/27.png" alt="27" ></zimg></p>
<p>ğŸ”¼ Draw a logo under the light source</p>
<p><zimg src="naruhodo/img-doc/29.png" alt="29" ></zimg></p>
<p>ğŸ”¼ The final versionğŸ‰</p>
<p><zimg src="naruhodo/img-doc/pre.jpg" alt=" ></zimg></p>
<p>ğŸ”¼ The presentation</p>
<p></p>
<hr />
<h3>Development log</h3>
<ul>
<li><p>9.1</p>
<ul>
<li>ç¡®å®šä½¿ç”¨ARåšæ¡Œä¸Šå®éªŒæ¨¡æ‹Ÿ</li>
<li>è°ƒç ”ARçš„å¼€æºå·¥å…·ï¼Œç¡®å®šå¯è¡Œæ€§</li>

</ul>
</li>
<li><p>9.2</p>
<ul>
<li>å»ºç«‹githubä»“åº“</li>
<li>æ‰“å°å„ç§marker</li>
<li>å°è¯•markerè¯†åˆ«çš„demo</li>

</ul>
</li>
<li><p>9.3</p>
<ul>
<li>æ”¯æŒä½¿ç”¨barcode</li>
<li>æ”¯æŒä½¿ç”¨å¤šä¸ªmarker</li>
<li>å¢åŠ æˆªå›¾åŠŸèƒ½</li>
<li>å¢åŠ gridçš„ç»˜åˆ¶</li>

</ul>
</li>
<li><p>9.4</p>
<ul>
<li>ç»˜åˆ¶å…‰çº¿ã€åŒæ­¥å…‰çº¿åæ ‡ç³»ä¸markeråæ ‡ç³»</li>
<li>åŠ å…¥UI</li>

</ul>
</li>
<li><p>9.5</p>
<ul>
<li>ä¿®å¤æ‰‹æœºæµè§ˆå™¨ä¸ŠUIä¸æ­£å¸¸çš„é—®é¢˜(éå¸¸å‘)</li>
<li>ç”»äº†ä¸ªicon</li>
<li>ç¾åŒ–UI</li>
<li>æ·»åŠ çƒé¢é•œå…ƒä»¶ï¼Œä½†æœ‰bug</li>

</ul>
</li>
<li><p>9.6</p>
<ul>
<li><p>ä¿®å¤åå°„å…‰çº¿æŠ–åŠ¨çš„bug</p>
</li>
<li><p>æ”¯æŒè‡ªå®šä¹‰å‚æ•°</p>
<ul>
<li>çƒé¢é•œçš„çƒåŠå¾„</li>
<li>ç‚¹å…‰æº/å¹³è¡Œå…‰æº</li>
<li>å…‰æºå…‰çº¿æ•°é‡</li>
<li>ç‚¹å…‰æºå‘æ•£åº¦</li>

</ul>
</li>
<li><p>å…‰æºä½¿ç”¨åŒmarkerï¼Œæ’å€¼å¢åŠ ç¨³å®šæ€§ï¼Œç¼ºå¤±ä¸€ä¸ªä¹Ÿå¯ä»¥å·¥ä½œ</p>
</li>
<li><p>å®ç°å‡¸é€é•œ</p>
</li>

</ul>
</li>
<li><p>9.7</p>
<ul>
<li>ä¿®å¤å…¨åå°„å¯¼è‡´çš„bug</li>
<li>æ˜¾ç¤ºå‡¸é€é•œã€çƒé¢é•œçš„mesh</li>
<li>æ”¯æŒåŠ¨æ€è°ƒæ•´meshçš„å‚æ•°</li>
<li>å…‰æºç”±&quot;çƒä½“&quot;ä¿®æ”¹æˆ&quot;åœ†å‘¨&quot;çš„</li>
<li>ç¾åŒ–å°é¢</li>

</ul>
</li>
<li><p>9.8</p>
<ul>
<li>æ”¯æŒé€æ˜æè´¨</li>

</ul>
</li>
<li><p>9.9</p>
<ul>
<li>æ”¯æŒå‡¹é€é•œ</li>

</ul>
</li>
<li><p>9.10</p>
<ul>
<li>æ”¯æŒå¹³é¢é•œ</li>
<li>æ”¯æŒä¸åŒé¢œè‰²çš„å…‰</li>
<li>æ›´æ¢äº†ä¸€ç§æ˜¾ç¤ºçš„æè´¨</li>

</ul>
</li>
<li><p>9.11</p>
<ul>
<li>è°ƒæ•´åŠå¾„æ”¹ä¸ºè°ƒæ•´ç„¦è·ï¼ŒçƒåŠå¾„ä¼šè‡ªåŠ¨æ ¹æ®ç„¦è·è®¡ç®—</li>
<li>å¹³å‡å„ä¸ªmarkeråæ ‡ç³»çš„ä½ç½®åŠæœå‘</li>

</ul>
</li>
<li><p>9.12</p>
<ul>
<li>ç»˜åˆ¶å…ƒä»¶åº•åº§</li>

</ul>
</li>
<li><p>9.15</p>
<ul>
<li>åšæˆç§¯æœ¨å—</li>
<li>æ·»åŠ é˜´å½±</li>
<li>ç»˜åˆ¶æ‰‹ç”µç­’ğŸ”¦</li>

</ul>
</li>
<li><p>9.16</p>
<ul>
<li>åœ¨å…‰æºåº•åº§ä¸Šç»˜åˆ¶logo</li>

</ul>
</li>

</ul>
<h3>å…‰çº¿ä¸å…‰å­¦å™¨ä»¶æ±‚äº¤</h3>
<p><strong>å’Œå‡¸é€é•œã€å‡¹é€é•œã€çƒé¢é•œæ±‚äº¤å‡å¯ä»¥çœ‹æˆå’Œçƒé¢é•œæ±‚äº¤</strong></p>
<p>åˆ†ä¸¤æ­¥:</p>
<ol start=" >
<li>å’Œçƒé¢é•œæ‰€åœ¨çš„çƒæ±‚äº¤</li>
<li>åˆ¤æ–­äº¤ç‚¹åˆæ³•æ€§</li>

</ol>
<p>å‡è®¾å…‰çº¿ç”±$(x_0, y_0, z_0)$å°„å‡ºï¼Œæ–¹å‘ä¸º$(a, b, c)$ï¼Œé‚£ä¹ˆå…‰çº¿å¯ä»¥è¡¨ç¤ºä¸º</p>
<p>$$(x_0, y_0, z_0) + t(a, b, c), t>\varepsilon$$ï¼Œ</p>
<p>å‡è®¾çƒæ˜¯$(x-x_b)^2+(y-y_b)^2+(z-z_b)^2=R^2$ï¼Œé‚£ä¹ˆç›¸äº¤æ—¶æœ‰</p>
<p>$$(x_0+ta-x_b)^2+(y_0+tb-y_b)^2+(z_0+tc-z_b)^2=R^2$$ï¼Œ</p>
<p>å¾—åˆ°å…³äº$t$çš„äºŒæ¬¡æ–¹ç¨‹:</p>
<p>$$(a^2+b^2+c^2)t^2+\\2(a(x_0-x_b)+b(y_0-y_b)+c(z_0-z_b))t+\\((x_0-x_b)^2+(y_0-y_b)^2+(z_0-z_b)^2-R^2)=0$$</p>
<p>å¯ç”±æ­¤è§£å‡º$t$ï¼Œå¹¶è¿›ä¸€æ­¥å¾—åˆ°äº¤ç‚¹ã€‚åˆ¤æ–­äº¤ç‚¹åˆæ³•æ€§å¯ä»¥æ±‚äº¤ç‚¹åˆ°é•œé¢ä¸­å¿ƒçš„è·ç¦»æ˜¯å¦åœ¨åˆæ³•èŒƒå›´ã€‚</p>
<pre><code class="language-javascript" lang="javascript">function testIntersectionToSpherePart(src, dir, center, R, r, e_center) {
	var p = testIntersectionToSphere(src, dir, center, R);
	for (var q of p) {
		var d = q.distanceTo(e_center);
		var t = Math.sqrt(sqr(r) + sqr(R - Math.sqrt(sqr(R) - sqr(r))));
		if (d &lt;= t) {
			var norm = center.clone().sub(q).normalize();
			return {
				pos: q,
				norm: norm
			};
		}
	}
	return null;
}

function testIntersectionToSphere(src, dir, center, R) {
	var a = dir.dot(dir);
	var sub = src.clone().sub(center);
	var b = 2 * dir.dot(sub);
	var c = sub.dot(sub) - R * R;

	var delta = b * b - 4 * a * c;
	var result = [];
	if (delta &gt;= 0) {
		delta = Math.sqrt(delta);
		var t1 = (-b - delta) / a / 2;
		var t2 = (-b + delta) / a / 2;
		if (t1 &gt; epsilon) result.push(src.clone().add(dir.clone().multiplyScalar(t1)));
		if (t2 &gt; epsilon) result.push(src.clone().add(dir.clone().multiplyScalar(t2)));
	}
	return result;
}
</code></pre>
<p><strong>å’Œå¹³é¢é•œæ±‚äº¤</strong></p>
<p>å¹³é¢é•œçš„ç©ºé—´è¡¨ç¤ºæ˜¯ä¸€ä¸ªä¸­å¿ƒç‚¹cåŠ ä¸Šxã€yæ–¹å‘ä¸¤ä¸ªæ­£äº¤å‘é‡çš„çº¿æ€§ç»„åˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ</p>
<p>$$src+t\cdot dir=c+a\cdot x+b\cdot y$$</p>
<p>æ»¡è¶³$-1\le a\le 1$ï¼Œ$-1\le b\le 1$ï¼Œ$t>\varepsilon$ã€‚</p>
<p>å…¶ä¸­$a$ã€$b$ã€$t$æ˜¯æ ‡é‡çš„æœªçŸ¥æ•°ï¼Œå…¶ä»–å‘é‡å¯ä»¥æŒªåˆ°ç­‰å·ä¸€è¾¹ï¼Œå˜æˆä¸‰å…ƒä¸€æ¬¡æ–¹ç¨‹ï¼Œå¯¹ä¸‰é˜¶çŸ©é˜µæ±‚é€†å³å¯ã€‚</p>
<pre><code class="language-javascript" lang="javascript">function testIntersectionToPlanePart(src, dir, c, x, y, norm) {
	var a1 = x.x; var a2 = x.y; var a3 = x.z;
	var b1 = y.x; var b2 = y.y; var b3 = y.z;
	var c1 = -dir.x; var c2 = -dir.y; var c3 = -dir.z;
	var det = a1 * (b2 * c3 - c2 * b3) - a2 * (b1 * c3 - c1 * b3) + a3 * (b1 * c2 - c1 * b2);
	if (Math.abs(det) &lt; epsilon) return null;
	var pa = new THREE.Vector3(b2 * c3 - c2 * b3, c1 * b3 - b1 * c3, b1 * c2 - c1 * b2);
	var pb = new THREE.Vector3(c2 * a3 - a2 * c3, a1 * c3 - c1 * a3, c1 * a2 - a1 * c2);
	var pt = new THREE.Vector3(a2 * b3 - b2 * a3, b1 * a3 - a1 * b3, a1 * b2 - b1 * a2);
	var s = src.clone().sub(c);
	var a = pa.dot(s) / det;
	var b = pb.dot(s) / det;
	var t = pt.dot(s) / det;
	if (t &lt; epsilon) return null;
	if (a &gt; 1 || b &gt; 1 || a &lt; -1 || b &lt; -1) return null;
	var pos = c.clone().add(x.clone().multiplyScalar(a)).add(y.clone().multiplyScalar(b));
	return {
		pos: pos,
		norm: norm
	}
}
</code></pre>
<h3>å…‰çº¿æŠ•å°„</h3>
<p>é¦–å…ˆå¯¹æ‰€æœ‰å…ƒä»¶æ±‚äº¤ï¼Œåœ¨æ‰€æœ‰äº¤ç‚¹ä¸­å–æœ€è¿‘çš„ã€‚</p>
<p>ç„¶åé’ˆå¯¹ä¸åŒå…ƒä»¶åšè¿›ä¸€æ­¥å¤„ç†:</p>
<ul>
<li>é•œé¢: æ‰¾åˆ°äº¤ç‚¹ã€æŒ‰æ­¤å¤„æ³•çº¿åå°„</li>
<li>é€é•œ: æ‰¾åˆ°äº¤ç‚¹ã€æ³•çº¿ï¼ŒæŒ‰æŠ˜å°„å…¬å¼æŠ˜å°„ï¼Œéœ€è¦å¤„ç†å…¨åå°„çš„æƒ…å†µ</li>

</ul>
<p>å¦‚æœç»è¿‡å…ƒä»¶å˜æ¢è¿›ä¸€æ­¥ç”Ÿæˆäº†æ–°çš„å…‰çº¿ï¼Œé‚£ä¹ˆç»§ç»­æŠ•å°„è¿™æ ¹æ–°çš„å…‰çº¿ã€‚</p>
<h3>Markerä½ç½®ã€æœå‘çš„å‡è¡¡</h3>
<p>çœ‹èµ·æ¥ç®€å•ä½†å®é™…éå¸¸å¤æ‚ã€‚ã€‚</p>
<p><strong>æœå‘å‡è¡¡</strong></p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%9B%9B%E5%85%83%E6%95%B0%E4%B8%8E%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AC" target="_blank" >https://zh.wikipedia.org/wiki/%E5%9B%9B%E5%85%83%E6%95%B0%E4%B8%8E%E7%A9%BA%E9%97%B4%E6%97%8B%E8%BD%AC</a></p>
<p>è¦è®©æ‰€æœ‰å…ƒä»¶çš„åæ ‡ç³»çš„yè½´æ–¹å‘ç»Ÿä¸€ã€‚</p>
<p>å°è¯•äº†å¤šç§æ–¹æ¡ˆï¼Œæœ€åå¯è¡Œçš„æ–¹æ³•æ˜¯ï¼Œæ±‚å‡ºæ¯ä¸ªå…ƒä»¶åæ ‡ç³»ä¸‹(0, 1, 0)çš„ä¸–ç•Œåæ ‡v[i]ï¼Œæ±‚å®ƒä»¬çš„å‡å€¼dirï¼Œå½’ä¸€åŒ–ã€‚</p>
<p>å¯¹äºæ¯ä¸ªå…ƒä»¶ï¼Œç”¨v[i]å‰ä¹˜dirå¾—åˆ°æ—‹è½¬è½´ï¼Œç‚¹ä¹˜å¾—åˆ°æ—‹è½¬è§’ï¼Œå†ç»•ç€è¿™ä¸ªè½´è½¬å³å¯ã€‚</p>
<p><strong>ä½ç½®å‡è¡¡</strong></p>
<p>æœå‘å‡è¡¡ä¹‹åï¼Œå„ä¸ªå…ƒä»¶åæ ‡ç³»çš„yè½´å˜å¾—å¹³è¡Œã€‚ä½ç½®å‡è¡¡å¯ä»¥ç¡®ä¿å„ä¸ªå…ƒä»¶çš„$xOz$å¹³é¢åœ¨åŒä¸€å¹³é¢ä¸Šã€‚</p>
<p>é¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªå…ƒä»¶çš„åæ ‡ç³»ä¸‹ï¼Œè¡¨ç¤ºå‡º(1, 0, 0) (0, 1, 0) (0, 0, 1)ä¸‰ä¸ªæ­£äº¤å•ä½å‘é‡:</p>
<pre><code class="language-javascript" lang="javascript">var x = new THREE.Vector3(1, 0, 0);
var y = new THREE.Vector3(0, 1, 0);
var z = new THREE.Vector3(0, 0, 1);
x.applyMatrix4(m[0].matrixWorld).sub(m[0].position);
y.applyMatrix4(m[0].matrixWorld).sub(m[0].position);
z.applyMatrix4(m[0].matrixWorld).sub(m[0].position);
</code></pre>
<p>ç„¶åè¿™ä¸‰ä¸ªå‘é‡å†™æˆåˆ—å‘é‡å†å¹¶èµ·æ¥æ‰€æ„æˆçš„æ–¹é˜µï¼Œå³è¾¹ä¹˜ä¸Šåˆ—å‘é‡$(a, b, c)^T$èƒ½å¾—åˆ°åœ¨ä¸€å·å…ƒä»¶åæ ‡ç³»ä¸‹ï¼Œåæ ‡(a, b, c)åœ¨ä¸–ç•Œåæ ‡ç³»ä¸­çš„è¡¨ç¤ºã€‚å‡è®¾è¿™ä¸ªä¸–ç•Œåæ ‡ç³»çš„åæ ‡æ˜¯(p, q, r)ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¿™ä¸ªåæ ‡å·¦è¾¹ä¹˜ä¸Šä¸Šé¢é‚£ä¸ªæ–¹é˜µçš„é€†çŸ©é˜µï¼Œå°±å¾—åˆ°äº†åœ¨ä¸€å·å…ƒä»¶åæ ‡ç³»ä¸‹çš„åæ ‡ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨è¿™ç§æ–¹æ³•ï¼ŒæŠŠæ‰€æœ‰å…ƒä»¶çš„åæ ‡ç³»åŸç‚¹æ”¾åœ¨ä¸€å·å…ƒä»¶åæ ‡ç³»ä¸‹è¡¨ç¤ºã€‚ç„¶åæ±‚å®ƒä»¬çš„yåæ ‡çš„å‡å€¼ï¼Œç”¨yçš„å‡å€¼æ›´æ–°åŸæœ‰çš„yï¼Œå°±å¾—åˆ°äº†å‡è¡¡ä¹‹åçš„åæ ‡ã€‚</p>
<h3>é˜´å½±æ•ˆæœ</h3>
<p>éœ€è¦åŠ ä¸€ä¸ªèƒ½castå‡ºé˜´å½±çš„å…‰æºï¼Œå¯ä»¥æ˜¯ç‚¹å…‰æºæˆ–è€…å¹³è¡Œå…‰æºã€‚å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ã€‚</p>
<p>æ¯ä¸ªé˜´å½±å…‰æºç›¸å½“äºä¸€ä¸ªç›¸æœºï¼Œéœ€è¦è®¾ç½®å„ç§ç›¸æœºå‚æ•°ï¼Œä»¥åŠshadowmapçš„åˆ†è¾¨ç‡ã€‚åˆ†è¾¨ç‡ã€ç›¸æœºå¯è§†èŒƒå›´ã€è½¯ä»¶æ€§èƒ½éœ€è¦åšä¸€ä¸ªæƒè¡¡ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨çš„è®¾è®¡æ˜¯é˜´å½±å…‰æºå›ºå®šåœ¨åœºæ™¯ä¸­ï¼Œä½¿ç”¨å¹³è¡Œå…‰æºï¼ŒæŠ•å°„æ–¹å‘ä¹Ÿæ˜¯å›ºå®šçš„ã€‚æ ¹æ®markeræ‰€åœ¨å¹³é¢ä½ç½®ï¼Œç”Ÿæˆä¸€ä¸ªæ¥æ”¶å½±å­çš„é€æ˜æè´¨ï¼Œå¯ä»¥æ¯”è¾ƒçœŸå®åœ°æ¨¡æ‹Ÿæ¡Œé¢ã€‚</p>
<h3>å…³å¡è®¾è®¡</h3>
<ul>
<li>ç”¨å¹³é¢é•œç­‰ï¼Œå°†å¹³è¡Œå…‰æºåå°„åˆ°æ—è¾¹æŸä¸ªæŒ‡å®šçš„åœˆé‡Œ</li>

</ul>
<ul>
<li>å¹³è¡Œå…‰-&gt;å‡¸é€é•œ-&gt;å‡¹é€é•œ-&gt;å˜æˆå¾ˆç»†çš„ä¸€æŸå¹³è¡Œå…‰ï¼Œç»è¿‡å¹³é¢é•œåå°„åˆ°ç›®æ ‡ï¼Œç›®æ ‡checkè¿™æŸå…‰æ˜¯å¦è¶³å¤Ÿç»†ä¸”å¹³è¡Œ</li>

</ul>
<h3>Note</h3>
<ul>
<li><p>æ¨¡å‹åœ¨Three.jsçš„sceneé‡Œæ˜¯è¿™æ ·ç»„ç»‡çš„: æ¯ä¸ªmarkeræ˜¯sceneçš„å­èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªgroupå¯¹è±¡ï¼Œå¯ä»¥ç»™è¿™ä¸ªgroupæ·»åŠ å­èŠ‚ç‚¹ã€‚å½“ç°å®ä¸–ç•Œçš„markerç§»åŠ¨ä¹‹åï¼Œè¿™ä¸ªmarker groupçš„åæ ‡ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå­èŠ‚ç‚¹ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
</li>
<li><p>å‡ ä½•å…‰å­¦å®éªŒ:</p>
<ul>
<li>å¹³è¡Œå…‰æºã€ç‚¹å…‰æºã€å‡¸é€é•œã€å‡¹é€é•œã€å‡¸é¢é•œã€å‡¹é¢é•œ</li>
<li>å…‰æºç”±ä¸¤ä¸ªmarkerç¡®å®šæ–¹å‘ï¼Œå¯ä»¥å°„å‡ºå¾ˆå¤šå…‰çº¿</li>

</ul>
</li>
<li><p>å•ç¼è¡å°„ã€åŒç¼å¹²æ¶‰å®éªŒ:</p>
<ul>
<li>çº¿å…‰æºã€å¯è°ƒçš„åŒç¼ã€‚ä¸éœ€è¦æ¥æ”¶å±ï¼Œå› ä¸ºæ¥æ”¶å±çš„ä½ç½®ä¸å½±å“è§‚å¯Ÿç»“æœï¼Œå¯ç”±åŒç¼ä½ç½®ç¡®å®šã€‚</li>
<li>åªæœ‰ä¸€ä¸ªç¼çš„æ—¶å€™ï¼Œå®éªŒå˜æˆå•ç¼å®éªŒã€‚</li>
<li>éœ€è¦åœ¨æ¥æ”¶å±ä¸Šæ–¹å¢åŠ äº®åº¦æ›²çº¿ã€‚</li>

</ul>
</li>
<li><p>ä¼˜åŠ¿:</p>
<ul>
<li>æ— éœ€ä¸“é—¨çš„å®éªŒå™¨æ</li>
<li>å¯ä»¥è§‚å¯Ÿåˆ°å…‰è·¯</li>
<li>å¯ä»¥è‡ªç”±è°ƒæ•´å„ä¸ªå™¨æçš„å…‰å­¦å‚æ•°</li>
<li>ä¸ç°å®ç»“åˆï¼Œå¯ä½“ä¼šåˆ°å¯¹è±¡å®é™…å°ºåº¦</li>

</ul>
</li>

</ul>
</body>
</html>